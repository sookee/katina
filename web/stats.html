<!DOCTYPE HTML>
<!-- 
/*-----------------------------------------------------------------.
| Copyright (C) 2013 SooKee oasookee@gmail.com               |
'------------------------------------------------------------------'

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
02110-1301, USA.

http://www.gnu.org/licenses/gpl-2.0.html

'-----------------------------------------------------------------*/
 -->
<html>
	<head>
		<script src="js/sarissa/sarissa-compressed.js"></script>
		<script src="js/sarissa/sarissa_ieemu_xpath-compressed.js"></script>
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/jquery.debug.js"></script>
		<script src="js/jquery.xslTransform.js"></script>
		<script src="js/rest-api.js"></script>
		<link rel="stylesheet" type="text/css" href="css/polls-table.css"/>
		<link rel="stylesheet" type="text/css" href="css/polls-sel-base.css"/>
	</head>
	<body>
		<script>
			var cserv = false;
			var cyear = false;
			var cmnth = false;
			var cmaps = false;
			var cguid = false;
			var cgame = false;
			var set = false;
			
			function reset()
			{
//				if(!set)
//				{
					document.getElementById("sel-serv").value = cserv;
					document.getElementById("sel-year").value = cyear;
					document.getElementById("sel-mnth").value = cmnth;
					document.getElementById("sel-maps").value = cmaps;
					document.getElementById("sel-guid").value = cguid;
					document.getElementById("sel-game").value = cgame;
//					set = true;
//				}
			}
			
			function injectBases()
			{
				cserv = $('#sel-serv').val();
				inject(
					{
						target: '#div-sel-serv'
						, action: injectYears
						, params: '?func=get_bases&format=generic'
					}
					, {
						xsl: 'xsl/rest-select-asoc.xsl'
						, options: {
							id: 'sel-serv'
							, prefix: 'sel-serv'
						}
					}
				);
				$('#sel-serv').val(cserv);
			}

			function injectYears()
			{
				cyear = $('#sel-year').val();
				inject(
					{
						target: '#div-sel-year'
						, action: injectMnth
						, params:'?func=get_years&format=generic'
							+ '&base=' + document.getElementById('sel-serv').value
					}
					, {
						xsl: 'xsl/rest-select.xsl'
						, options: {
							id: 'sel-year'
							, prefix: 'sel-year'
						}
					}
				);		
				$('#sel-year').val(cyear);
			}
			
			function injectMnth()
			{
				cmnth = $('#sel-mnth').val();
				inject(
					{
						target: '#div-sel-mnth'
						, action: injectMaps
						, params:'?func=get_months&format=generic'
							+ '&base=' + document.getElementById('sel-serv').value
							+ '&year=' + document.getElementById('sel-year').value
					}
					, {
						xsl: 'xsl/rest-select-asoc.xsl'
						, options: {
							id: 'sel-mnth'
							, prefix: 'sel-mnth'
						}
					}
				);		
				$('#sel-mnth').val(cmnth);
			}
		
			function injectMaps()
			{
				cmaps = $('#sel-maps').val();
				
				var sy = parseInt(document.getElementById('sel-year').value);
				var ey = sy;
				var sm = parseInt(document.getElementById('sel-mnth').value);
				var em = sm + 1;
				if(em > 12)
				{
					em = 1;
					++ey;
				}
				var sdate = sy + '-' + (sm<10?'0':'') + sm + '-00';
				var edate = ey + '-' + (em<10?'0':'') + em + '-00';
				inject(
					{
						target: '#div-sel-maps'
						, action: injectGuid
						, params:'?func=get_maps&format=generic'
							+ '&base=' + document.getElementById('sel-serv').value
							+ '&sdate=' + sdate
							+ '&edate=' + edate
					}
					, {
						xsl: 'xsl/rest-select.xsl'
						, options: {
							id: 'sel-maps'
							, prefix: 'sel-maps'
						}
					}
				);		
				$('#sel-maps').val(cmaps);
			}
//			// TODO: here
			function injectGuid()
			{
//				inject({
//					id: 'sel-mnth'
//					, xsl: 'xsl/rest-sel-base.xsl'
//					, target: '#div-sel-year'
//					, action: injectGame
////					, prefix: 'xsl-rest-sel-base'
//					, params:'?func=get_months'
//						+ '&base=' + document.getElementById('sel-serv').value
//						+ '&poll=' + document.getElementById('sel-year').value
//				});		
			}
//			
//			function injectGame()
//			{
//				inject({
//					id: 'sel-mnth'
//					, xsl: 'xsl/rest-sel-base.xsl'
//					, target: '#div-sel-year'
//					, action: injectYears
////					, prefix: 'xsl-rest-sel-base'
//					, params:'?func=get_months'
//						+ '&base=' + document.getElementById('sel-serv').value
//						+ '&poll=' + document.getElementById('sel-year').value
//				});		
//			}
			
			$(document).ready(function() {
				injectBases();
			});
		</script>
		<div id="selectors"> <!--[server][year|*][month|*][map|*][guid|*][game_id|*]-->
			<div id="div-sel-serv"></div>
			<div id="div-sel-year"></div>
			<div id="div-sel-mnth"></div>
			<div id="div-sel-maps"></div>
			<div id="div-sel-guid"></div>
			<div id="div-sel-game"></div>
		</div>
		<div id="displayers">
			<div id="div-dis-serv"></div>
			<div id="div-dis-year"></div>
			<div id="div-dis-mnth"></div>
			<div id="div-dis-maps"></div>
			<div id="div-dis-guid"></div>
			<div id="div-dis-game"></div>
		</div>
<!--
{year:
	Year
	{month:
		Month|The whole year|The year to date ?(to date)
		{map:
			Mapname|All Maps
			{guid:
				Player|All Players
				{game_id:
					FPH, CPH, FPH * CPH, F/D, C/D%, F/D * C/D%
				}
			}
		}
	}
}
-->
	</body>
</html>